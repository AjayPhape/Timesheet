<!DOCTYPE html>
<html>
{% load static%}
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>jsGrid - Basic Scenario</title>
{% block css%}
    <link rel="stylesheet" type="text/css" href="{% static '/demos/demos.css' %}" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="{% static '/css/jsgrid.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static '/css/theme.css' %}"/>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.2/themes/cupertino/jquery-ui.css">

    <style>
        .hasDatepicker {
            width: 100px;
            text-align: center;
        }

        .ui-datepicker * {
            font-family: 'Helvetica Neue Light', 'Open Sans', Helvetica;
            font-size: 14px;
            font-weight: 300 !important;
        }
    </style>
{% endblock css %}
</head>
<body>
    <h1>Timesheet</h1>
    <div id="jsGrid"></div>
    {% block script %}
    {% csrf_token%}
    <script src="{% static '/external/jquery/jquery-1.8.3.js'%}"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="{% static '/demos/db.js'%}"></script>

    <script src="{% static '/src/jsgrid.core.js'%}"></script>
    <script src="{% static '/src/jsgrid.load-indicator.js'%}"></script>
    <script src="{% static '/src/jsgrid.load-strategies.js'%}"></script>
    <script src="{% static '/src/jsgrid.sort-strategies.js'%}"></script>
    <script src="{% static '/src/jsgrid.field.js'%}"></script>
    <script src="{% static '/src/fields/jsgrid.field.text.js'%}"></script>
    <script src="{% static '/src/fields/jsgrid.field.number.js'%}"></script>
    <script src="{% static '/src/fields/jsgrid.field.select.js'%}"></script>
    <script src="{% static '/src/fields/jsgrid.field.checkbox.js'%}"></script>
    <script src="{% static '/src/fields/jsgrid.field.control.js'%}"></script>
    <script>
        $(function() {

            var MyDateField = function(config) {
                jsGrid.Field.call(this, config);
            };

            MyDateField.prototype = new jsGrid.Field({
                sorter: function(date1, date2) {
                    return new Date(date1) - new Date(date2);
                },

                itemTemplate: function(value) {
                    return new Date(value).toDateString();
                },

                insertTemplate: function(value) {
                    return this._insertPicker = $("<input>").datepicker({ defaultDate: new Date() });
                },

                editTemplate: function(value) {
                    return this._editPicker = $("<input>").datepicker().datepicker("setDate", new Date(value));
                },

                insertValue: function() {
                    return this._insertPicker.datepicker("getDate").toISOString();
                },

                editValue: function() {
                    return this._editPicker.datepicker("getDate").toISOString();
                }
            });

            jsGrid.fields.myDateField = MyDateField;

            $("#jsGrid").jsGrid({
                height: "70%",
                width: "100%",
                filtering: true,
                editing: true,
                inserting: true,
                sorting: true,
                paging: true,
                autoload: true,
                pageSize: 15,
                pageButtonCount: 5,
                deleteConfirm: "Do you really want to delete the client?",
                controller: {

                loadData: function(filter) {
                    var d = $.Deferred();
                    $.ajax({
                        type: "GET",
                        url: "/timesheet/api",
                        data: filter
                    }).done(function(result) {
                        d.resolve($.map(JSON.parse(result), function(item) {
                            return $.extend(item.fields, { id: item.pk });
                        }));
                    });
                    return d.promise();
                },

                insertItem: function(item) {
                        return $.ajax({
                            type: "POST",
                            url: '/timesheet/api/',
                            data: item
                        });
                    },
                updateItem: function(item) {
                        return $.ajax({
                            type: "PUT",
                            url: "/timesheet/api/" + item.id+"/",
                            data: item
                        });
                    },
                deleteItem: function(item) {
                    return $.ajax({
                        type: "DELETE",
                        url: "/timesheet/api/" + item.id+"/"
                    });
                }
                },
                fields: [
                    { name: "name", type: "text", width: 250 },
                    { name: "consumed_hours", type: "number", width: 100 },
                    { name: "work_date", type: "myDateField", width: 100, align: "center"},
                    { type: "control" }
                ]
            });
        });
    </script>
{% endblock script%}
</body>
</html>
